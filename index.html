<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Business ERP Solution - Philippines</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8f9fa;
        }

        .menu-btn {
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 300;
            background: #0062cc;
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 10px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,98,204,0.5);
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .menu-btn:active {
            background: #004494;
            transform: scale(0.95);
        }

        .hamburger {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .hamburger span {
            display: block;
            width: 25px;
            height: 3px;
            background: white;
            border-radius: 2px;
            transition: all 0.3s;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 250;
            display: none;
        }

        .overlay.active {
            display: block;
        }

        .sidebar {
            position: fixed;
            top: 0;
            left: -300px;
            width: 280px;
            height: 100vh;
            background: white;
            z-index: 260;
            transition: left 0.3s ease;
            overflow-y: auto;
            box-shadow: 5px 0 20px rgba(0,0,0,0.3);
        }

        .sidebar.active {
            left: 0;
        }

        .sidebar-header {
            padding: 70px 20px 20px 20px;
            background: #0062cc;
            color: white;
            text-align: center;
        }

        .sidebar-header h3 {
            margin: 0;
        }

        .menu-items {
            padding: 10px;
        }

        .menu-item {
            padding: 15px 20px;
            margin: 5px 0;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s;
            background: #f8f9fa;
            color: #333;
            font-weight: 600;
            display: block;
            text-decoration: none;
        }

        .menu-item:hover {
            background: #0062cc;
            color: white;
            transform: translateX(5px);
        }

        .hero {
            background: linear-gradient(135deg, #0062cc 0%, #004494 100%);
            color: white;
            padding: 80px 20px 60px 80px;
            text-align: center;
        }

        .hero h1 {
            font-size: 2.5em;
            margin-bottom: 15px;
        }

        .hero p {
            font-size: 1.2em;
            opacity: 0.95;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .section {
            background: white;
            margin: 20px 0;
            padding: 30px 20px;
            border-radius: 15px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
            display: none;
        }

        .section.active {
            display: block;
        }

        .section-title {
            color: #0062cc;
            font-size: 2em;
            margin-bottom: 25px;
            text-align: center;
            padding-bottom: 15px;
            border-bottom: 3px solid #0062cc;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #0062cc 0%, #004494 100%);
            color: white;
            padding: 25px 15px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 3px 15px rgba(0,98,204,0.3);
        }

        .stat-card h4 {
            font-size: 0.9em;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .stat-card .value {
            font-size: 2em;
            font-weight: bold;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin: 25px 0;
            flex-wrap: wrap;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            min-width: 160px;
        }

        .btn-primary {
            background: #0062cc;
            color: white;
        }

        .btn-primary:hover {
            background: #004494;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
            padding: 8px 16px;
            font-size: 0.85em;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .data-table th {
            background: #0062cc;
            color: white;
            padding: 15px 10px;
            text-align: left;
            font-size: 0.9em;
        }

        .data-table td {
            padding: 12px 10px;
            border-bottom: 1px solid #e9ecef;
            font-size: 0.85em;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        .function-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .function-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            border: 2px solid #e9ecef;
            transition: all 0.3s;
        }

        .function-card:hover {
            border-color: #0062cc;
            box-shadow: 0 5px 20px rgba(0,98,204,0.15);
            transform: translateY(-5px);
        }

        .function-card h3 {
            color: #0062cc;
            margin-bottom: 15px;
        }

        .function-card ul {
            list-style: none;
            padding: 0;
        }

        .function-card li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
        }

        .function-card li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #28a745;
            font-weight: bold;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 24px;
            background: #e9ecef;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab.active {
            background: #0062cc;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 400;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            color: #999;
            cursor: pointer;
            background: none;
            border: none;
        }

        .close-modal:hover {
            color: #333;
        }

        .form-group {
            margin: 20px 0;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #0062cc;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 20px 30px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            z-index: 500;
            display: none;
        }

        .notification.show {
            display: block;
        }

        .save-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.85em;
            z-index: 500;
            display: none;
            box-shadow: 0 3px 10px rgba(0,0,0,0.3);
        }

        .save-indicator.show {
            display: block;
            animation: fadeInOut 2s;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0; }
            20%, 80% { opacity: 1; }
        }

        .backup-section {
            background: #fff3cd;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #ffc107;
        }

        .backup-section h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        .footer {
            background: #1a1a1a;
            color: white;
            text-align: center;
            padding: 40px 20px;
            margin-top: 60px;
        }

        .footer p {
            margin: 10px 0;
            opacity: 0.8;
        }

        .report-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .report-section h3 {
            color: #0062cc;
            margin-bottom: 15px;
        }

        .report-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #dee2e6;
        }

        .report-item:last-child {
            border-bottom: none;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .status-low {
            background: #dc3545;
            color: white;
        }

        .status-ok {
            background: #28a745;
            color: white;
        }

        .status-pending {
            background: #ffc107;
            color: #333;
        }

        .print-preview {
            display: none;
        }

        @media print {
            body * {
                visibility: hidden;
            }
            .print-preview, .print-preview * {
                visibility: visible;
            }
            .print-preview {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                display: block;
            }
            .menu-btn, .sidebar, .overlay, .hero, .action-buttons, 
            .notification, .save-indicator, .footer, button {
                display: none !important;
            }
        }

        .invoice-print {
            max-width: 800px;
            margin: 0 auto;
            padding: 40px;
            background: white;
            font-family: 'Courier New', monospace;
        }

        .invoice-header {
            text-align: center;
            border-bottom: 2px solid #333;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        .invoice-header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .invoice-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .invoice-items {
            margin: 30px 0;
        }

        .invoice-items table {
            width: 100%;
            border-collapse: collapse;
        }

        .invoice-items th,
        .invoice-items td {
            border: 1px solid #333;
            padding: 10px;
            text-align: left;
        }

        .invoice-items th {
            background: #f0f0f0;
        }

        .invoice-total {
            text-align: right;
            font-size: 1.3em;
            font-weight: bold;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #333;
        }

        .btn-print {
            background: #6c757d;
            color: white;
            padding: 8px 16px;
            font-size: 0.85em;
        }

        .btn-print:hover {
            background: #5a6268;
        }

        @media (max-width: 768px) {
            .hero {
                padding: 70px 20px 40px 70px;
            }

            .hero h1 {
                font-size: 1.8em;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                min-width: auto;
            }

            .function-grid {
                grid-template-columns: 1fr;
            }

            .data-table {
                font-size: 0.8em;
            }
        }
    </style>
</head>
<body>
    <button class="menu-btn" onclick="toggleMenu()">
        <div class="hamburger">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </button>

    <div class="overlay" id="overlay" onclick="closeMenu()"></div>

    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h3>üìã Main Menu</h3>
        </div>
        <div class="menu-items">
            <div class="menu-item" onclick="goToSection('inventory')">üì¶ Inventory & Products</div>
            <div class="menu-item" onclick="goToSection('accounting')">üíº Money & Accounting</div>
            <div class="menu-item" onclick="goToSection('payroll')">üí∞ Employees & Payroll</div>
            <div class="menu-item" onclick="goToSection('sales')">üõí Sales & Customers</div>
            <div class="menu-item" onclick="goToSection('production')">üè≠ Production</div>
            <div class="menu-item" onclick="goToSection('store')">üõç Online Store</div>
            <div class="menu-item" onclick="goToSection('documents')">üìÑ Documents</div>
            <div class="menu-item" onclick="goToSection('reports')">üìä Reports</div>
        </div>
    </div>

    <div class="hero">
        <h1>üöÄ Complete Business Management</h1>
        <p>ERP System for Filipino Businesses</p>
    </div>

    <div class="container">
        <!-- Inventory Section -->
        <div id="inventory" class="section active">
            <h2 class="section-title">üì¶ Inventory & Products Management</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <h4>Total Products</h4>
                    <div class="value" id="totalProducts">0</div>
                </div>
                <div class="stat-card">
                    <h4>Low Stock Items</h4>
                    <div class="value" id="lowStock">0</div>
                </div>
                <div class="stat-card">
                    <h4>Total Value</h4>
                    <div class="value">‚Ç±<span id="totalValue">0</span></div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-primary" onclick="showAddProduct()">‚ûï Add New Product</button>
                <button class="btn btn-success" onclick="checkStock()">üîç Check Low Stock</button>
            </div>

            <table class="data-table">
                <thead>
                    <tr>
                        <th>Code</th>
                        <th>Product Name</th>
                        <th>Category</th>
                        <th>Stock</th>
                        <th>Price</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="productTable"></tbody>
            </table>
        </div>

        <!-- Accounting Section -->
        <div id="accounting" class="section">
            <h2 class="section-title">üíº Money & Accounting</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <h4>Total Income</h4>
                    <div class="value" style="color: #4ade80;">‚Ç±<span id="totalIncome">0</span></div>
                </div>
                <div class="stat-card">
                    <h4>Total Expenses</h4>
                    <div class="value" style="color: #f87171;">‚Ç±<span id="totalExpenses">0</span></div>
                </div>
                <div class="stat-card">
                    <h4>Net Profit</h4>
                    <div class="value">‚Ç±<span id="netProfit">0</span></div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-primary" onclick="showAddTransaction()">‚ûï Add Transaction</button>
                <button class="btn btn-success" onclick="generateFinancialReport()">üìä Generate Report</button>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="switchAccountingTab(event, 'income')">Income</button>
                <button class="tab" onclick="switchAccountingTab(event, 'expenses')">Expenses</button>
            </div>

            <div id="income" class="tab-content active">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Description</th>
                            <th>Category</th>
                            <th>Amount</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="incomeTable"></tbody>
                </table>
            </div>

            <div id="expenses" class="tab-content">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Description</th>
                            <th>Category</th>
                            <th>Amount</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="expensesTable"></tbody>
                </table>
            </div>
        </div>

        <!-- Payroll Section -->
        <div id="payroll" class="section">
            <h2 class="section-title">üí∞ Employees & Payroll</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <h4>Total Employees</h4>
                    <div class="value" id="totalEmployees">0</div>
                </div>
                <div class="stat-card">
                    <h4>Monthly Payroll</h4>
                    <div class="value">‚Ç±<span id="monthlyPayroll">0</span></div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-primary" onclick="showAddEmployee()">‚ûï Add Employee</button>
                <button class="btn btn-success" onclick="calculatePayroll()">üí∞ Calculate Payroll</button>
            </div>

            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Position</th>
                        <th>Basic Salary</th>
                        <th>Deductions</th>
                        <th>Net Salary</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="employeeTable"></tbody>
            </table>
        </div>

        <!-- Sales Section -->
        <div id="sales" class="section">
            <h2 class="section-title">üõí Sales & Customers</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <h4>Total Customers</h4>
                    <div class="value" id="totalCustomers">0</div>
                </div>
                <div class="stat-card">
                    <h4>Today's Sales</h4>
                    <div class="value">‚Ç±<span id="todaySales">0</span></div>
                </div>
                <div class="stat-card">
                    <h4>Total Sales</h4>
                    <div class="value">‚Ç±<span id="totalSales">0</span></div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-primary" onclick="showAddCustomer()">‚ûï Add Customer</button>
                <button class="btn btn-success" onclick="showCreateInvoice()">üìÑ Create Invoice</button>
            </div>

            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Contact</th>
                        <th>Email</th>
                        <th>Total Purchases</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="customerTable"></tbody>
            </table>
        </div>

        <!-- Production Section -->
        <div id="production" class="section">
            <h2 class="section-title">üè≠ Production & Manufacturing</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <h4>Active Orders</h4>
                    <div class="value" id="activeOrders">0</div>
                </div>
                <div class="stat-card">
                    <h4>Completed</h4>
                    <div class="value" id="completedOrders">0</div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-primary" onclick="showCreateWorkOrder()">‚ûï Create Work Order</button>
                <button class="btn btn-success" onclick="showCreateBOM()">üìã Create BOM</button>
            </div>

            <table class="data-table">
                <thead>
                    <tr>
                        <th>Order ID</th>
                        <th>Product</th>
                        <th>Quantity</th>
                        <th>Status</th>
                        <th>Start Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="workOrderTable"></tbody>
            </table>
        </div>

        <!-- Online Store Section -->
        <div id="store" class="section">
            <h2 class="section-title">üõç Online Store Management</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <h4>Published Products</h4>
                    <div class="value" id="publishedProductsCount">0</div>
                </div>
                <div class="stat-card">
                    <h4>Online Orders</h4>
                    <div class="value" id="onlineOrdersCount">0</div>
                </div>
                <div class="stat-card">
                    <h4>Pending Delivery</h4>
                    <div class="value" id="pendingDeliveryCount">0</div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-primary" onclick="showPublishProduct()">üåê Publish Product</button>
                <button class="btn btn-success" onclick="showCreateOnlineOrder()">üõí Create Order</button>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="switchStoreTab(event, 'published')">Published Products</button>
                <button class="tab" onclick="switchStoreTab(event, 'orders')">Online Orders</button>
            </div>

            <div id="published" class="tab-content active">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Product</th>
                            <th>Category</th>
                            <th>Stock</th>
                            <th>Online Price</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="publishedProductsTable"></tbody>
                </table>
            </div>

            <div id="orders" class="tab-content">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Order ID</th>
                            <th>Customer</th>
                            <th>Product</th>
                            <th>Qty</th>
                            <th>Amount</th>
                            <th>Payment</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="storeOrderTable"></tbody>
                </table>
            </div>
        </div>

        <!-- Documents Section -->
        <div id="documents" class="section">
            <h2 class="section-title">üìÑ Documents & Contracts</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <h4>Total Documents</h4>
                    <div class="value" id="totalDocuments">0</div>
                </div>
                <div class="stat-card">
                    <h4>Pending Signatures</h4>
                    <div class="value" id="pendingSignatures">0</div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-primary" onclick="showUploadDocument()">üì§ Upload Document</button>
                <button class="btn btn-success" onclick="showSignDocument()">‚úçÔ∏è E-Sign Document</button>
            </div>

            <table class="data-table">
                <thead>
                    <tr>
                        <th>Document Name</th>
                        <th>Category</th>
                        <th>Upload Date</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="documentTable"></tbody>
            </table>
        </div>

        <!-- Reports Section -->
        <div id="reports" class="section">
            <h2 class="section-title">üìä Reports & Analytics</h2>
            
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="generateSalesReport()">üìà Sales Report</button>
                <button class="btn btn-primary" onclick="generateInventoryReport()">üì¶ Inventory Report</button>
                <button class="btn btn-success" onclick="exportAllReports()">üì• Export All</button>
            </div>

            <div id="reportsDisplay"></div>
        </div>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="hideModal()">√ó</button>
            <div id="modalBody"></div>
        </div>
    </div>

    <div id="notification" class="notification"></div>
    <div id="saveIndicator" class="save-indicator">üíæ Data Saved!</div>

    <div class="footer">
        <div class="backup-section" style="max-width:800px;margin:20px auto;">
            <h4>üì¶ Backup Your Data</h4>
            <div style="display:flex;gap:10px;flex-wrap:wrap;">
                <button class="btn btn-primary" onclick="backupData()" style="flex:1;min-width:150px;">üì• Download Backup</button>
                <button class="btn btn-success" onclick="document.getElementById('restoreFile').click()" style="flex:1;min-width:150px;">üì§ Restore Backup</button>
                <button class="btn btn-danger" onclick="clearAllData()" style="flex:1;min-width:150px;">üóëÔ∏è Clear All Data</button>
            </div>
            <input type="file" id="restoreFile" accept=".json" style="display:none" onchange="restoreData(event)">
            <p style="margin-top:10px;font-size:0.85em;color:#856404;">
                üí° Tip: Download backup regularly! Data is saved in your browser only.
            </p>
        </div>
        <p><strong>Business Management Solutions Philippines</strong></p>
        <p>&copy; 2024 All Rights Reserved</p>
    </div>

    <script>
        // Load data from localStorage or initialize empty arrays
        let products = JSON.parse(localStorage.getItem('products')) || [];
        let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
        let employees = JSON.parse(localStorage.getItem('employees')) || [];
        let customers = JSON.parse(localStorage.getItem('customers')) || [];
        let workOrders = JSON.parse(localStorage.getItem('workOrders')) || [];
        let storeOrders = JSON.parse(localStorage.getItem('storeOrders')) || [];
        let documents = JSON.parse(localStorage.getItem('documents')) || [];
        let invoices = JSON.parse(localStorage.getItem('invoices')) || [];
        let publishedProducts = JSON.parse(localStorage.getItem('publishedProducts')) || [];

        // Save data to localStorage
        function saveData() {
            try {
                localStorage.setItem('products', JSON.stringify(products));
                localStorage.setItem('transactions', JSON.stringify(transactions));
                localStorage.setItem('employees', JSON.stringify(employees));
                localStorage.setItem('customers', JSON.stringify(customers));
                localStorage.setItem('workOrders', JSON.stringify(workOrders));
                localStorage.setItem('storeOrders', JSON.stringify(storeOrders));
                localStorage.setItem('documents', JSON.stringify(documents));
                localStorage.setItem('invoices', JSON.stringify(invoices));
                localStorage.setItem('publishedProducts', JSON.stringify(publishedProducts));
                
                // Show save indicator
                const indicator = document.getElementById('saveIndicator');
                indicator.classList.add('show');
                setTimeout(() => indicator.classList.remove('show'), 2000);
            } catch (e) {
                showNotification('‚ö†Ô∏è Could not save data! Browser storage may be full or disabled.', 'error');
                console.error('Save error:', e);
            }
        }

        // Backup data to file
        function backupData() {
            const allData = {
                products: products,
                transactions: transactions,
                employees: employees,
                customers: customers,
                workOrders: workOrders,
                storeOrders: storeOrders,
                documents: documents,
                invoices: invoices,
                publishedProducts: publishedProducts,
                backupDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(allData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `erp-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            
            showNotification('‚úÖ Backup downloaded successfully!');
        }

        // Restore data from file
        function restoreData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (confirm('This will replace all current data. Continue?')) {
                        products = data.products || [];
                        transactions = data.transactions || [];
                        employees = data.employees || [];
                        customers = data.customers || [];
                        workOrders = data.workOrders || [];
                        storeOrders = data.storeOrders || [];
                        documents = data.documents || [];
                        invoices = data.invoices || [];
                        publishedProducts = data.publishedProducts || [];
                        
                        saveData();
                        
                        updateInventoryDisplay();
                        updateAccountingDisplay();
                        updatePayrollDisplay();
                        updateCustomerDisplay();
                        updateProductionDisplay();
                        updateDocumentDisplay();
                        updateStoreDisplay();
                        
                        showNotification('‚úÖ Data restored successfully!');
                    }
                } catch (error) {
                    showNotification('‚ùå Invalid backup file!', 'error');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        // Clear all data
        function clearAllData() {
            if (confirm('‚ö†Ô∏è This will delete ALL data permanently! Are you sure?')) {
                if (confirm('Really sure? This cannot be undone!')) {
                    localStorage.clear();
                    products = [];
                    transactions = [];
                    employees = [];
                    customers = [];
                    workOrders = [];
                    storeOrders = [];
                    documents = [];
                    invoices = [];
                    publishedProducts = [];
                    
                    updateInventoryDisplay();
                    updateAccountingDisplay();
                    updatePayrollDisplay();
                    updateCustomerDisplay();
                    updateProductionDisplay();
                    updateDocumentDisplay();
                    updateStoreDisplay();
                    
                    showNotification('All data cleared!');
                }
            }
        }

        function toggleMenu() {
            document.getElementById('sidebar').classList.toggle('active');
            document.getElementById('overlay').classList.toggle('active');
        }

        function closeMenu() {
            document.getElementById('sidebar').classList.remove('active');
            document.getElementById('overlay').classList.remove('active');
        }

        function goToSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            closeMenu();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function showModal(title, content) {
            document.getElementById('modalBody').innerHTML = `<h2>${title}</h2>${content}`;
            document.getElementById('modal').classList.add('show');
        }

        function hideModal() {
            document.getElementById('modal').classList.remove('show');
        }

        function showNotification(message, type = 'success') {
            const notif = document.getElementById('notification');
            notif.textContent = message;
            notif.className = 'notification show' + (type === 'error' ? ' error' : '');
            setTimeout(() => notif.classList.remove('show'), 3000);
        }

        // INVENTORY FUNCTIONS
        function showAddProduct() {
            const form = `
                <form onsubmit="addProduct(event)">
                    <div class="form-group">
                        <label>Product Code *</label>
                        <input type="text" id="productCode" required>
                    </div>
                    <div class="form-group">
                        <label>Product Name *</label>
                        <input type="text" id="productName" required>
                    </div>
                    <div class="form-group">
                        <label>Category *</label>
                        <select id="productCategory" required>
                            <option value="">Select Category</option>
                            <option value="Electronics">Electronics</option>
                            <option value="Clothing">Clothing</option>
                            <option value="Food">Food</option>
                            <option value="Tools">Tools</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Stock Quantity *</label>
                        <input type="number" id="productStock" required min="0">
                    </div>
                    <div class="form-group">
                        <label>Reorder Level *</label>
                        <input type="number" id="reorderLevel" required min="0">
                    </div>
                    <div class="form-group">
                        <label>Price (‚Ç±) *</label>
                        <input type="number" id="productPrice" required min="0" step="0.01">
                    </div>
                    <button type="submit" class="btn btn-primary" style="width:100%">Add Product</button>
                </form>
            `;
            showModal('Add New Product', form);
        }

        function addProduct(e) {
            e.preventDefault();
            const product = {
                id: Date.now(),
                code: document.getElementById('productCode').value,
                name: document.getElementById('productName').value,
                category: document.getElementById('productCategory').value,
                stock: parseInt(document.getElementById('productStock').value),
                reorderLevel: parseInt(document.getElementById('reorderLevel').value),
                price: parseFloat(document.getElementById('productPrice').value)
            };
            products.push(product);
            saveData();
            updateInventoryDisplay();
            hideModal();
            showNotification('Product added successfully!');
        }

        function updateInventoryDisplay() {
            const tbody = document.getElementById('productTable');
            if (products.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;padding:30px">No products yet</td></tr>';
            } else {
                tbody.innerHTML = products.map(p => `
                    <tr>
                        <td>${p.code}</td>
                        <td>${p.name}</td>
                        <td>${p.category}</td>
                        <td>${p.stock}</td>
                        <td>‚Ç±${p.price.toFixed(2)}</td>
                        <td><span class="status-badge ${p.stock <= p.reorderLevel ? 'status-low' : 'status-ok'}">${p.stock <= p.reorderLevel ? 'Low Stock' : 'OK'}</span></td>
                        <td><button class="btn-danger" onclick="deleteProduct(${p.id})">Delete</button></td>
                    </tr>
                `).join('');
            }
            document.getElementById('totalProducts').textContent = products.length;
            document.getElementById('lowStock').textContent = products.filter(p => p.stock <= p.reorderLevel).length;
            document.getElementById('totalValue').textContent = products.reduce((sum, p) => sum + (p.stock * p.price), 0).toFixed(2);
        }

        function deleteProduct(id) {
            if (confirm('Delete this product?')) {
                products = products.filter(p => p.id !== id);
                saveData();
                updateInventoryDisplay();
                showNotification('Product deleted');
            }
        }

        function checkStock() {
            const lowStockItems = products.filter(p => p.stock <= p.reorderLevel);
            if (lowStockItems.length === 0) {
                showNotification('All items are well stocked!');
            } else {
                const list = lowStockItems.map(p => `<li>${p.name}: ${p.stock} units (Reorder at ${p.reorderLevel})</li>`).join('');
                showModal('Low Stock Alert', `<ul>${list}</ul>`);
            }
        }

        // ACCOUNTING FUNCTIONS
        function showAddTransaction() {
            const form = `
                <form onsubmit="addTransaction(event)">
                    <div class="form-group">
                        <label>Type *</label>
                        <select id="transType" required>
                            <option value="income">Income</option>
                            <option value="expense">Expense</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Description *</label>
                        <input type="text" id="transDesc" required>
                    </div>
                    <div class="form-group">
                        <label>Category *</label>
                        <select id="transCategory" required>
                            <option value="Sales">Sales</option>
                            <option value="Services">Services</option>
                            <option value="Salary">Salary</option>
                            <option value="Rent">Rent</option>
                            <option value="Utilities">Utilities</option>
                            <option value="Supplies">Supplies</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Amount (‚Ç±) *</label>
                        <input type="number" id="transAmount" required min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Date *</label>
                        <input type="date" id="transDate" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width:100%">Add Transaction</button>
                </form>
            `;
            showModal('Add Transaction', form);
        }

        function addTransaction(e) {
            e.preventDefault();
            const trans = {
                id: Date.now(),
                type: document.getElementById('transType').value,
                description: document.getElementById('transDesc').value,
                category: document.getElementById('transCategory').value,
                amount: parseFloat(document.getElementById('transAmount').value),
                date: document.getElementById('transDate').value
            };
            transactions.push(trans);
            saveData();
            updateAccountingDisplay();
            hideModal();
            showNotification('Transaction added successfully!');
        }

        function updateAccountingDisplay() {
            const income = transactions.filter(t => t.type === 'income');
            const expenses = transactions.filter(t => t.type === 'expense');
            
            const incomeTotal = income.reduce((sum, t) => sum + t.amount, 0);
            const expensesTotal = expenses.reduce((sum, t) => sum + t.amount, 0);
            
            document.getElementById('totalIncome').textContent = incomeTotal.toFixed(2);
            document.getElementById('totalExpenses').textContent = expensesTotal.toFixed(2);
            document.getElementById('netProfit').textContent = (incomeTotal - expensesTotal).toFixed(2);
            
            const incomeTable = document.getElementById('incomeTable');
            if (income.length === 0) {
                incomeTable.innerHTML = '<tr><td colspan="5" style="text-align:center;padding:30px">No income transactions</td></tr>';
            } else {
                incomeTable.innerHTML = income.map(t => `
                    <tr>
                        <td>${t.date}</td>
                        <td>${t.description}</td>
                        <td>${t.category}</td>
                        <td>‚Ç±${t.amount.toFixed(2)}</td>
                        <td><button class="btn-danger" onclick="deleteTransaction(${t.id})">Delete</button></td>
                    </tr>
                `).join('');
            }
            
            const expensesTable = document.getElementById('expensesTable');
            if (expenses.length === 0) {
                expensesTable.innerHTML = '<tr><td colspan="5" style="text-align:center;padding:30px">No expense transactions</td></tr>';
            } else {
                expensesTable.innerHTML = expenses.map(t => `
                    <tr>
                        <td>${t.date}</td>
                        <td>${t.description}</td>
                        <td>${t.category}</td>
                        <td>‚Ç±${t.amount.toFixed(2)}</td>
                        <td><button class="btn-danger" onclick="deleteTransaction(${t.id})">Delete</button></td>
                    </tr>
                `).join('');
            }
        }

        function deleteTransaction(id) {
            if (confirm('Delete this transaction?')) {
                transactions = transactions.filter(t => t.id !== id);
                saveData();
                updateAccountingDisplay();
                showNotification('Transaction deleted');
            }
        }

        function switchAccountingTab(e, tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            e.target.classList.add('active');
            document.getElementById(tab).classList.add('active');
        }

        function generateFinancialReport() {
            const income = transactions.filter(t => t.type === 'income');
            const expenses = transactions.filter(t => t.type === 'expense');
            const incomeTotal = income.reduce((sum, t) => sum + t.amount, 0);
            const expensesTotal = expenses.reduce((sum, t) => sum + t.amount, 0);
            
            const report = `
                <div class="report-section">
                    <h3>Profit & Loss Statement</h3>
                    <div class="report-item"><strong>Total Income:</strong> <span style="color:#28a745">‚Ç±${incomeTotal.toFixed(2)}</span></div>
                    <div class="report-item"><strong>Total Expenses:</strong> <span style="color:#dc3545">‚Ç±${expensesTotal.toFixed(2)}</span></div>
                    <div class="report-item"><strong>Net Profit:</strong> <span style="color:#0062cc;font-size:1.2em">‚Ç±${(incomeTotal - expensesTotal).toFixed(2)}</span></div>
                </div>
                <div class="report-section">
                    <h3>Income by Category</h3>
                    ${getCategoryBreakdown(income)}
                </div>
                <div class="report-section">
                    <h3>Expenses by Category</h3>
                    ${getCategoryBreakdown(expenses)}
                </div>
            `;
            showModal('Financial Report', report);
        }

        function getCategoryBreakdown(items) {
            const categories = {};
            items.forEach(item => {
                categories[item.category] = (categories[item.category] || 0) + item.amount;
            });
            return Object.entries(categories).map(([cat, amt]) => 
                `<div class="report-item"><span>${cat}:</span> <span>‚Ç±${amt.toFixed(2)}</span></div>`
            ).join('');
        }

        // PAYROLL FUNCTIONS
        function showAddEmployee() {
            const form = `
                <form onsubmit="addEmployee(event)">
                    <div class="form-group">
                        <label>Employee ID *</label>
                        <input type="text" id="empId" required>
                    </div>
                    <div class="form-group">
                        <label>Full Name *</label>
                        <input type="text" id="empName" required>
                    </div>
                    <div class="form-group">
                        <label>Position *</label>
                        <input type="text" id="empPosition" required>
                    </div>
                    <div class="form-group">
                        <label>Basic Monthly Salary (‚Ç±) *</label>
                        <input type="number" id="empSalary" required min="0" step="0.01">
                    </div>
                    <button type="submit" class="btn btn-primary" style="width:100%">Add Employee</button>
                </form>
            `;
            showModal('Add Employee', form);
        }

        function addEmployee(e) {
            e.preventDefault();
            const emp = {
                id: Date.now(),
                empId: document.getElementById('empId').value,
                name: document.getElementById('empName').value,
                position: document.getElementById('empPosition').value,
                basicSalary: parseFloat(document.getElementById('empSalary').value)
            };
            employees.push(emp);
            saveData();
            updatePayrollDisplay();
            hideModal();
            showNotification('Employee added successfully!');
        }

        function updatePayrollDisplay() {
            const tbody = document.getElementById('employeeTable');
            if (employees.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;padding:30px">No employees yet</td></tr>';
            } else {
                tbody.innerHTML = employees.map(e => {
                    const deductions = calculateDeductions(e.basicSalary);
                    const netSalary = e.basicSalary - deductions.total;
                    return `
                        <tr>
                            <td>${e.empId}</td>
                            <td>${e.name}</td>
                            <td>${e.position}</td>
                            <td>‚Ç±${e.basicSalary.toFixed(2)}</td>
                            <td>‚Ç±${deductions.total.toFixed(2)}</td>
                            <td>‚Ç±${netSalary.toFixed(2)}</td>
                            <td><button class="btn-danger" onclick="deleteEmployee(${e.id})">Delete</button></td>
                        </tr>
                    `;
                }).join('');
            }
            
            document.getElementById('totalEmployees').textContent = employees.length;
            const totalPayroll = employees.reduce((sum, e) => {
                const deductions = calculateDeductions(e.basicSalary);
                return sum + (e.basicSalary - deductions.total);
            }, 0);
            document.getElementById('monthlyPayroll').textContent = totalPayroll.toFixed(2);
        }

        function calculateDeductions(salary) {
            const sss = salary * 0.045;
            const philhealth = salary * 0.02;
            const pagibig = 100;
            return {
                sss: sss,
                philhealth: philhealth,
                pagibig: pagibig,
                total: sss + philhealth + pagibig
            };
        }

        function deleteEmployee(id) {
            if (confirm('Delete this employee?')) {
                employees = employees.filter(e => e.id !== id);
                saveData();
                updatePayrollDisplay();
                showNotification('Employee deleted');
            }
        }

        function calculatePayroll() {
            if (employees.length === 0) {
                showNotification('No employees to calculate payroll', 'error');
                return;
            }
            
            let report = '<div class="report-section"><h3>Payroll Summary</h3>';
            employees.forEach(e => {
                const ded = calculateDeductions(e.basicSalary);
                report += `
                    <div style="margin:15px 0; padding:15px; background:#f8f9fa; border-radius:8px">
                        <strong>${e.name}</strong> (${e.position})<br>
                        Basic: ‚Ç±${e.basicSalary.toFixed(2)}<br>
                        SSS: ‚Ç±${ded.sss.toFixed(2)} | PhilHealth: ‚Ç±${ded.philhealth.toFixed(2)} | Pag-IBIG: ‚Ç±${ded.pagibig.toFixed(2)}<br>
                        <strong>Net Pay: ‚Ç±${(e.basicSalary - ded.total).toFixed(2)}</strong>
                    </div>
                `;
            });
            report += '</div>';
            showModal('Payroll Calculation', report);
        }

        // SALES & CUSTOMERS FUNCTIONS
        function showAddCustomer() {
            const form = `
                <form onsubmit="addCustomer(event)">
                    <div class="form-group">
                        <label>Customer ID *</label>
                        <input type="text" id="custId" required>
                    </div>
                    <div class="form-group">
                        <label>Full Name *</label>
                        <input type="text" id="custName" required>
                    </div>
                    <div class="form-group">
                        <label>Contact Number *</label>
                        <input type="text" id="custContact" required>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="custEmail">
                    </div>
                    <button type="submit" class="btn btn-primary" style="width:100%">Add Customer</button>
                </form>
            `;
            showModal('Add Customer', form);
        }

        function addCustomer(e) {
            e.preventDefault();
            const cust = {
                id: Date.now(),
                custId: document.getElementById('custId').value,
                name: document.getElementById('custName').value,
                contact: document.getElementById('custContact').value,
                email: document.getElementById('custEmail').value || 'N/A',
                totalPurchases: 0
            };
            customers.push(cust);
            saveData();
            updateCustomerDisplay();
            hideModal();
            showNotification('Customer added successfully!');
        }

        function updateCustomerDisplay() {
            const tbody = document.getElementById('customerTable');
            if (customers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:30px">No customers yet</td></tr>';
            } else {
                tbody.innerHTML = customers.map(c => `
                    <tr>
                        <td>${c.custId}</td>
                        <td>${c.name}</td>
                        <td>${c.contact}</td>
                        <td>${c.email}</td>
                        <td>‚Ç±${c.totalPurchases.toFixed(2)}</td>
                        <td><button class="btn-danger" onclick="deleteCustomer(${c.id})">Delete</button></td>
                    </tr>
                `).join('');
            }
            document.getElementById('totalCustomers').textContent = customers.length;
            updateSalesStats();
        }

        function deleteCustomer(id) {
            if (confirm('Delete this customer?')) {
                customers = customers.filter(c => c.id !== id);
                saveData();
                updateCustomerDisplay();
                showNotification('Customer deleted');
            }
        }

        function showCreateInvoice() {
            if (customers.length === 0 || products.length === 0) {
                showNotification('Add customers and products first!', 'error');
                return;
            }
            
            const form = `
                <form onsubmit="createInvoice(event)">
                    <div class="form-group">
                        <label>Customer *</label>
                        <select id="invoiceCustomer" required>
                            ${customers.map(c => `<option value="${c.id}">${c.name}</option>`).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Product *</label>
                        <select id="invoiceProduct" required>
                            ${products.map(p => `<option value="${p.id}">${p.name} - ‚Ç±${p.price}</option>`).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Quantity *</label>
                        <input type="number" id="invoiceQty" required min="1">
                    </div>
                    <button type="submit" class="btn btn-primary" style="width:100%">Create Invoice</button>
                </form>
            `;
            showModal('Create Invoice', form);
        }

        function createInvoice(e) {
            e.preventDefault();
            const custId = parseInt(document.getElementById('invoiceCustomer').value);
            const prodId = parseInt(document.getElementById('invoiceProduct').value);
            const qty = parseInt(document.getElementById('invoiceQty').value);
            
            const customer = customers.find(c => c.id === custId);
            const product = products.find(p => p.id === prodId);
            
            if (product.stock < qty) {
                showNotification('Insufficient stock!', 'error');
                return;
            }
            
            const total = product.price * qty;
            product.stock -= qty;
            customer.totalPurchases += total;
            
            const invoice = {
                id: Date.now(),
                date: new Date().toISOString().split('T')[0],
                customer: customer.name,
                product: product.name,
                qty: qty,
                total: total
            };
            invoices.push(invoice);
            
            saveData();
            updateInventoryDisplay();
            updateCustomerDisplay();
            hideModal();
            showNotification(`Invoice created! Total: ‚Ç±${total.toFixed(2)}`);
        }

        function updateSalesStats() {
            const today = new Date().toISOString().split('T')[0];
            const todaySales = invoices.filter(inv => inv.date === today).reduce((sum, inv) => sum + inv.total, 0);
            const totalSales = invoices.reduce((sum, inv) => sum + inv.total, 0);
            
            document.getElementById('todaySales').textContent = todaySales.toFixed(2);
            document.getElementById('totalSales').textContent = totalSales.toFixed(2);
        }

        // PRODUCTION FUNCTIONS
        function showCreateWorkOrder() {
            if (products.length === 0) {
                showNotification('Add products first!', 'error');
                return;
            }
            
            const form = `
                <form onsubmit="createWorkOrder(event)">
                    <div class="form-group">
                        <label>Product *</label>
                        <select id="woProduct" required>
                            ${products.map(p => `<option value="${p.id}">${p.name}</option>`).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Quantity to Produce *</label>
                        <input type="number" id="woQty" required min="1">
                    </div>
                    <div class="form-group">
                        <label>Start Date *</label>
                        <input type="date" id="woDate" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width:100%">Create Work Order</button>
                </form>
            `;
            showModal('Create Work Order', form);
        }

        function createWorkOrder(e) {
            e.preventDefault();
            const prodId = parseInt(document.getElementById('woProduct').value);
            const product = products.find(p => p.id === prodId);
            
            const wo = {
                id: Date.now(),
                orderId: 'WO' + Date.now(),
                product: product.name,
                quantity: parseInt(document.getElementById('woQty').value),
                status: 'Active',
                startDate: document.getElementById('woDate').value
            };
            workOrders.push(wo);
            saveData();
            updateProductionDisplay();
            hideModal();
            showNotification('Work order created successfully!');
        }

        function updateProductionDisplay() {
            const tbody = document.getElementById('workOrderTable');
            if (workOrders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:30px">No work orders yet</td></tr>';
            } else {
                tbody.innerHTML = workOrders.map(wo => `
                    <tr>
                        <td>${wo.orderId}</td>
                        <td>${wo.product}</td>
                        <td>${wo.quantity}</td>
                        <td><span class="status-badge ${wo.status === 'Active' ? 'status-pending' : 'status-ok'}">${wo.status}</span></td>
                        <td>${wo.startDate}</td>
                        <td>
                            ${wo.status === 'Active' ? `<button class="btn btn-success" onclick="completeWorkOrder(${wo.id})">Complete</button>` : ''}
                            <button class="btn-danger" onclick="deleteWorkOrder(${wo.id})">Delete</button>
                        </td>
                    </tr>
                `).join('');
            }
            
            document.getElementById('activeOrders').textContent = workOrders.filter(wo => wo.status === 'Active').length;
            document.getElementById('completedOrders').textContent = workOrders.filter(wo => wo.status === 'Completed').length;
        }

        function completeWorkOrder(id) {
            const wo = workOrders.find(w => w.id === id);
            wo.status = 'Completed';
            
            const product = products.find(p => p.name === wo.product);
            if (product) {
                product.stock += wo.quantity;
                updateInventoryDisplay();
            }
            
            saveData();
            updateProductionDisplay();
            showNotification('Work order completed! Stock updated.');
        }

        function deleteWorkOrder(id) {
            if (confirm('Delete this work order?')) {
                workOrders = workOrders.filter(wo => wo.id !== id);
                saveData();
                updateProductionDisplay();
                showNotification('Work order deleted');
            }
        }

        function showCreateBOM() {
            showNotification('Bill of Materials (BOM) feature - Specify raw materials needed for production');
        }

        // ONLINE STORE FUNCTIONS
        function showPublishProduct() {
            if (products.length === 0) {
                showNotification('Add products to inventory first!', 'error');
                return;
            }
            
            const unpublished = products.filter(p => !publishedProducts.find(pub => pub.productId === p.id));
            if (unpublished.length === 0) {
                showNotification('All products are already published!', 'error');
                return;
            }
            
            const form = `
                <form onsubmit="publishProduct(event)">
                    <div class="form-group">
                        <label>Select Product *</label>
                        <select id="pubProduct" required onchange="updatePricePreview()">
                            <option value="">Choose a product</option>
                            ${unpublished.map(p => `<option value="${p.id}" data-price="${p.price}">${p.name} (Stock: ${p.stock})</option>`).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Original Price: <span id="originalPrice">‚Ç±0.00</span></label>
                    </div>
                    <div class="form-group">
                        <label>Online Price (‚Ç±) *</label>
                        <input type="number" id="pubPrice" required min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Product Description</label>
                        <textarea id="pubDesc" rows="3" placeholder="Describe your product for online customers..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width:100%">Publish to Online Store</button>
                </form>
            `;
            showModal('Publish Product Online', form);
        }

        function updatePricePreview() {
            const select = document.getElementById('pubProduct');
            const selectedOption = select.options[select.selectedIndex];
            const price = selectedOption.getAttribute('data-price');
            document.getElementById('originalPrice').textContent = price ? `‚Ç±${parseFloat(price).toFixed(2)}` : '‚Ç±0.00';
            document.getElementById('pubPrice').value = price || '';
        }

        function publishProduct(e) {
            e.preventDefault();
            const prodId = parseInt(document.getElementById('pubProduct').value);
            const product = products.find(p => p.id === prodId);
            
            const published = {
                id: Date.now(),
                productId: product.id,
                name: product.name,
                category: product.category,
                stock: product.stock,
                originalPrice: product.price,
                onlinePrice: parseFloat(document.getElementById('pubPrice').value),
                description: document.getElementById('pubDesc').value || 'No description',
                publishDate: new Date().toISOString().split('T')[0],
                status: 'Active'
            };
            
            publishedProducts.push(published);
            saveData();
            updateStoreDisplay();
            hideModal();
            showNotification(`${product.name} published to online store!`);
        }

        function updateStoreDisplay() {
            // Update published products table
            const pubTable = document.getElementById('publishedProductsTable');
            if (publishedProducts.length === 0) {
                pubTable.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:30px">No products published yet</td></tr>';
            } else {
                pubTable.innerHTML = publishedProducts.map(p => {
                    const product = products.find(prod => prod.id === p.productId);
                    const currentStock = product ? product.stock : 0;
                    return `
                        <tr>
                            <td>${p.name}</td>
                            <td>${p.category}</td>
                            <td>${currentStock}</td>
                            <td>‚Ç±${p.onlinePrice.toFixed(2)}</td>
                            <td><span class="status-badge ${p.status === 'Active' ? 'status-ok' : 'status-low'}">${p.status}</span></td>
                            <td><button class="btn-danger" onclick="unpublishProduct(${p.id})">Unpublish</button></td>
                        </tr>
                    `;
                }).join('');
            }
            
            // Update orders table
            const orderTable = document.getElementById('storeOrderTable');
            if (storeOrders.length === 0) {
                orderTable.innerHTML = '<tr><td colspan="8" style="text-align:center;padding:30px">No online orders yet</td></tr>';
            } else {
                orderTable.innerHTML = storeOrders.map(o => `
                    <tr>
                        <td>${o.orderId}</td>
                        <td>${o.customerName}</td>
                        <td>${o.productName}</td>
                        <td>${o.quantity}</td>
                        <td>‚Ç±${o.total.toFixed(2)}</td>
                        <td>${o.paymentMethod}</td>
                        <td><span class="status-badge ${getStatusClass(o.status)}">${o.status}</span></td>
                        <td>
                            ${o.status === 'Pending' ? `<button class="btn btn-success" onclick="updateOrderStatus(${o.id}, 'Processing')">Process</button>` : ''}
                            ${o.status === 'Processing' ? `<button class="btn btn-success" onclick="updateOrderStatus(${o.id}, 'Shipped')">Ship</button>` : ''}
                            ${o.status === 'Shipped' ? `<button class="btn btn-success" onclick="updateOrderStatus(${o.id}, 'Delivered')">Deliver</button>` : ''}
                            <button class="btn-danger" onclick="cancelOrder(${o.id})">Cancel</button>
                        </td>
                    </tr>
                `).join('');
            }
            
            // Update stats
            document.getElementById('publishedProductsCount').textContent = publishedProducts.length;
            document.getElementById('onlineOrdersCount').textContent = storeOrders.length;
            document.getElementById('pendingDeliveryCount').textContent = storeOrders.filter(o => o.status === 'Pending' || o.status === 'Processing' || o.status === 'Shipped').length;
        }

        function getStatusClass(status) {
            switch(status) {
                case 'Pending': return 'status-pending';
                case 'Processing': return 'status-pending';
                case 'Shipped': return 'status-pending';
                case 'Delivered': return 'status-ok';
                case 'Cancelled': return 'status-low';
                default: return 'status-pending';
            }
        }

        function unpublishProduct(id) {
            if (confirm('Unpublish this product from online store?')) {
                publishedProducts = publishedProducts.filter(p => p.id !== id);
                saveData();
                updateStoreDisplay();
                showNotification('Product unpublished');
            }
        }

        function showCreateOnlineOrder() {
            if (publishedProducts.length === 0) {
                showNotification('Publish products first!', 'error');
                return;
            }
            
            if (customers.length === 0) {
                showNotification('Add customers first!', 'error');
                return;
            }
            
            const form = `
                <form onsubmit="createOnlineOrder(event)">
                    <div class="form-group">
                        <label>Customer *</label>
                        <select id="orderCustomer" required>
                            ${customers.map(c => `<option value="${c.id}">${c.name}</option>`).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Product *</label>
                        <select id="orderProduct" required onchange="updateOrderTotal()">
                            ${publishedProducts.map(p => {
                                const product = products.find(prod => prod.id === p.productId);
                                const stock = product ? product.stock : 0;
                                return `<option value="${p.id}" data-price="${p.onlinePrice}" data-stock="${stock}">${p.name} - ‚Ç±${p.onlinePrice.toFixed(2)} (Stock: ${stock})</option>`;
                            }).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Quantity *</label>
                        <input type="number" id="orderQty" required min="1" value="1" onchange="updateOrderTotal()">
                    </div>
                    <div class="form-group">
                        <label>Payment Method *</label>
                        <select id="orderPayment" required>
                            <option value="GCash">GCash</option>
                            <option value="PayMaya">PayMaya</option>
                            <option value="Bank Transfer">Bank Transfer</option>
                            <option value="Cash on Delivery">Cash on Delivery</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Delivery Address *</label>
                        <textarea id="orderAddress" required rows="2"></textarea>
                    </div>
                    <div class="form-group">
                        <label style="font-size:1.2em;color:#0062cc;">Total: ‚Ç±<span id="orderTotal">0.00</span></label>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width:100%">Create Order</button>
                </form>
            `;
            showModal('Create Online Order', form);
            setTimeout(updateOrderTotal, 100);
        }

        function updateOrderTotal() {
            const select = document.getElementById('orderProduct');
            const qty = parseInt(document.getElementById('orderQty').value) || 0;
            const selectedOption = select.options[select.selectedIndex];
            const price = parseFloat(selectedOption.getAttribute('data-price')) || 0;
            const total = price * qty;
            document.getElementById('orderTotal').textContent = total.toFixed(2);
        }

        function createOnlineOrder(e) {
            e.preventDefault();
            
            const custId = parseInt(document.getElementById('orderCustomer').value);
            const pubId = parseInt(document.getElementById('orderProduct').value);
            const qty = parseInt(document.getElementById('orderQty').value);
            
            const customer = customers.find(c => c.id === custId);
            const publishedProd = publishedProducts.find(p => p.id === pubId);
            const product = products.find(p => p.id === publishedProd.productId);
            
            if (product.stock < qty) {
                showNotification('Insufficient stock!', 'error');
                return;
            }
            
            const total = publishedProd.onlinePrice * qty;
            
            const order = {
                id: Date.now(),
                orderId: 'ORD' + Date.now(),
                customerName: customer.name,
                customerContact: customer.contact,
                productName: publishedProd.name,
                quantity: qty,
                total: total,
                paymentMethod: document.getElementById('orderPayment').value,
                deliveryAddress: document.getElementById('orderAddress').value,
                status: 'Pending',
                orderDate: new Date().toISOString().split('T')[0]
            };
            
            storeOrders.push(order);
            product.stock -= qty;
            customer.totalPurchases += total;
            
            saveData();
            updateStoreDisplay();
            updateInventoryDisplay();
            updateCustomerDisplay();
            hideModal();
            showNotification(`Order ${order.orderId} created successfully!`);
        }

        function updateOrderStatus(id, newStatus) {
            const order = storeOrders.find(o => o.id === id);
            order.status = newStatus;
            saveData();
            updateStoreDisplay();
            showNotification(`Order updated to ${newStatus}`);
        }

        function cancelOrder(id) {
            if (confirm('Cancel this order?')) {
                const order = storeOrders.find(o => o.id === id);
                
                if (order.status !== 'Delivered' && order.status !== 'Cancelled') {
                    const publishedProd = publishedProducts.find(p => p.name === order.productName);
                    if (publishedProd) {
                        const product = products.find(p => p.id === publishedProd.productId);
                        if (product) {
                            product.stock += order.quantity;
                        }
                    }
                }
                
                order.status = 'Cancelled';
                saveData();
                updateStoreDisplay();
                updateInventoryDisplay();
                showNotification('Order cancelled');
            }
        }

        function switchStoreTab(e, tab) {
            document.querySelectorAll('#store .tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('#store .tab-content').forEach(c => c.classList.remove('active'));
            e.target.classList.add('active');
            document.getElementById(tab).classList.add('active');
        }

        function viewOnlineOrders() {
            updateStoreDisplay();
        }

        // DOCUMENTS FUNCTIONS
        function showUploadDocument() {
            const form = `
                <form onsubmit="uploadDocument(event)">
                    <div class="form-group">
                        <label>Document Name *</label>
                        <input type="text" id="docName" required>
                    </div>
                    <div class="form-group">
                        <label>Category *</label>
                        <select id="docCategory" required>
                            <option value="Contract">Contract</option>
                            <option value="Invoice">Invoice</option>
                            <option value="Report">Report</option>
                            <option value="Legal">Legal</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="docDesc" rows="3"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width:100%">Upload Document</button>
                </form>
            `;
            showModal('Upload Document', form);
        }

        function uploadDocument(e) {
            e.preventDefault();
            const doc = {
                id: Date.now(),
                name: document.getElementById('docName').value,
                category: document.getElementById('docCategory').value,
                uploadDate: new Date().toISOString().split('T')[0],
                status: 'Active',
                description: document.getElementById('docDesc').value || 'N/A'
            };
            documents.push(doc);
            saveData();
            updateDocumentDisplay();
            hideModal();
            showNotification('Document uploaded successfully!');
        }

        function updateDocumentDisplay() {
            const tbody = document.getElementById('documentTable');
            if (documents.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;padding:30px">No documents yet</td></tr>';
            } else {
                tbody.innerHTML = documents.map(d => `
                    <tr>
                        <td>${d.name}</td>
                        <td>${d.category}</td>
                        <td>${d.uploadDate}</td>
                        <td><span class="status-badge status-ok">${d.status}</span></td>
                        <td><button class="btn-danger" onclick="deleteDocument(${d.id})">Delete</button></td>
                    </tr>
                `).join('');
            }
            document.getElementById('totalDocuments').textContent = documents.length;
        }

        function deleteDocument(id) {
            if (confirm('Delete this document?')) {
                documents = documents.filter(d => d.id !== id);
                saveData();
                updateDocumentDisplay();
                showNotification('Document deleted');
            }
        }

        function showSignDocument() {
            if (documents.length === 0) {
                showNotification('Upload documents first!', 'error');
                return;
            }
            showNotification('E-Signature feature - Select document to sign digitally');
        }

        // REPORTS FUNCTIONS
        function generateSalesReport() {
            if (invoices.length === 0) {
                showNotification('No sales data available', 'error');
                return;
            }
            
            const report = `
                <div class="report-section">
                    <h3>Sales Summary</h3>
                    <div class="report-item"><strong>Total Invoices:</strong> ${invoices.length}</div>
                    <div class="report-item"><strong>Total Revenue:</strong> ‚Ç±${invoices.reduce((sum, inv) => sum + inv.total, 0).toFixed(2)}</div>
                    <div class="report-item"><strong>Average Sale:</strong> ‚Ç±${(invoices.reduce((sum, inv) => sum + inv.total, 0) / invoices.length).toFixed(2)}</div>
                </div>
                <div class="report-section">
                    <h3>Recent Sales</h3>
                    ${invoices.slice(-5).reverse().map(inv => 
                        `<div class="report-item">
                            <span>${inv.date} - ${inv.customer}</span>
                            <span>‚Ç±${inv.total.toFixed(2)}</span>
                        </div>`
                    ).join('')}
                </div>
            `;
            showModal('Sales Report', report);
        }

        function generateInventoryReport() {
            if (products.length === 0) {
                showNotification('No inventory data available', 'error');
                return;
            }
            
            const totalValue = products.reduce((sum, p) => sum + (p.stock * p.price), 0);
            const report = `
                <div class="report-section">
                    <h3>Inventory Overview</h3>
                    <div class="report-item"><strong>Total Products:</strong> ${products.length}</div>
                    <div class="report-item"><strong>Total Inventory Value:</strong> ‚Ç±${totalValue.toFixed(2)}</div>
                    <div class="report-item"><strong>Low Stock Items:</strong> ${products.filter(p => p.stock <= p.reorderLevel).length}</div>
                </div>
                <div class="report-section">
                    <h3>Stock by Category</h3>
                    ${getStockByCategory()}
                </div>
                <div class="report-section">
                    <h3>Top 5 Most Valuable Items</h3>
                    ${products
                        .map(p => ({...p, value: p.stock * p.price}))
                        .sort((a, b) => b.value - a.value)
                        .slice(0, 5)
                        .map(p => `<div class="report-item"><span>${p.name}</span> <span>‚Ç±${p.value.toFixed(2)}</span></div>`)
                        .join('')}
                </div>
            `;
            showModal('Inventory Report', report);
        }

        function getStockByCategory() {
            const categories = {};
            products.forEach(p => {
                if (!categories[p.category]) {
                    categories[p.category] = {count: 0, value: 0};
                }
                categories[p.category].count += p.stock;
                categories[p.category].value += p.stock * p.price;
            });
            return Object.entries(categories).map(([cat, data]) => 
                `<div class="report-item">
                    <span>${cat}: ${data.count} units</span>
                    <span>‚Ç±${data.value.toFixed(2)}</span>
                </div>`
            ).join('');
        }

        function exportAllReports() {
            const allData = {
                products: products,
                transactions: transactions,
                employees: employees,
                customers: customers,
                invoices: invoices,
                workOrders: workOrders,
                documents: documents,
                generatedDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(allData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `business-report-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('All reports exported successfully!');
        }

        // Initialize on load
        window.addEventListener('load', () => {
            // Check if localStorage is working
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                console.log('‚úÖ localStorage is working');
            } catch (e) {
                showNotification('‚ö†Ô∏è Browser storage disabled! Data will not save. Enable cookies/storage in settings.', 'error');
            }
            
            updateInventoryDisplay();
            updateAccountingDisplay();
            updatePayrollDisplay();
            updateCustomerDisplay();
            updateProductionDisplay();
            updateDocumentDisplay();
            updateStoreDisplay();
            
            // Show welcome message if first time
            if (!localStorage.getItem('visited')) {
                localStorage.setItem('visited', 'true');
                showNotification('üëã Welcome! Your data is auto-saved. Download backups regularly!');
            }
        });
    </script>
</body>
</html>